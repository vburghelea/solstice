# Development Backlog

**Last Updated**: January 2025

This is the prioritized development roadmap for Solstice, Roundup Games' community platform for tabletop and board game organizers. Each ticket includes priority (P0 = highest), status, dependencies, and key implementation details.

---

## üö® Critical Issues (Address First)

These are production-critical issues that should be addressed before new feature development:

### CRIT-1: Fix Payment Webhook Verification

|                |                                                                                                                                                                                                                                                                                                                                                                                                                                |
| -------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **Status**     | ‚ùå Not Started                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **Priority**   | üî¥ Critical (Security/Money handling)                                                                                                                                                                                                                                                                                                                                                                                          |
| **Issue**      | Payment verification is mocked (line 160-165 in square-real.ts). This means we're not actually verifying payments in production.                                                                                                                                                                                                                                                                                               |
| **Code refs**  | `src/lib/payments/square-real.ts:160-165`, `src/routes/api/webhooks/square.ts`                                                                                                                                                                                                                                                                                                                                                 |
| **Tasks**      | <ul><li>Replace mocked payment verification with real Square API calls</li><li>Store checkout sessions in database when created</li><li>Update webhook handler to create membership records on payment.updated COMPLETED status</li><li>Implement polling fallback for confirmMembershipPurchase</li><li>Add database migration for payment_sessions table</li><li>Test webhook signature verification in production</li></ul> |
| **Why urgent** | Current implementation accepts any payment as valid. Real money is at risk.                                                                                                                                                                                                                                                                                                                                                    |

### CRIT-2: Remove Obsolete Rate Limiting Code ‚úÖ

|                |                                                                                                                                                                                                                                             |
| -------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Status**     | ‚úÖ Completed                                                                                                                                                                                                                                |
| **Priority**   | üü° High (Quick win, removes confusion)                                                                                                                                                                                                      |
| **Issue**      | Old in-memory rate limiting code exists alongside TanStack Pacer implementation                                                                                                                                                             |
| **Code refs**  | `src/lib/security/middleware/rate-limit.ts` (DELETED), `src/lib/pacer/*` (KEPT)                                                                                                                                                             |
| **Tasks**      | <ul><li>‚úÖ Delete `src/lib/security/middleware/rate-limit.ts`</li><li>‚úÖ Remove any imports of the old rate limiter</li><li>‚úÖ Update CLAUDE.md to remove references to old system</li><li>‚úÖ Verify all rate limiting uses Pacer</li></ul> |
| **Completion** | Removed obsolete server-side rate limiting, updated auth route to use direct handler, cleaned up documentation                                                                                                                              |

---

## üî∫ P1 ‚Äì High Priority

### EVT-2: Event Registration Pricing & Payment Tests

|                          |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| ------------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Status**               | ‚úÖ Completed                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| **Priority**             | üü† High (regression protection for revenue flows)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| **Problem**              | `calculateRegistrationAmountCents` and the surrounding `registerForEvent` payment logic lack dedicated tests. Early-bird discounts, zero-cost events, and e-transfer paths are currently unverified and at risk of silent regression.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **Desired Outcome**      | Deterministic coverage exercising pricing calculations and payment state transitions so future changes cannot break discount windows, amount rounding, or payment status tagging without failing CI.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **Implementation Notes** | <ul><li>Write a focused unit test suite (e.g., `registration-pricing.test.ts`) covering discount boundaries, rounding, zero-fee events, and both `team`/`individual` registration types.</li><li>Stub payment metadata generation and ensure the mutation transitions to `paid`, `awaiting_etransfer`, or `pending` as expected for the different permutations.</li><li>Backfill tests for the JSONB casting helpers so roster and payment metadata persist correctly.</li><li>Ensure tests mock the Square payment service (`squarePaymentService`) when verifying square-flow branches.</li></ul>                                                                                                                                                                                                                   |
| **Linked Files**         | <ul><li>[src/features/events/events.mutations.ts](../src/features/events/events.mutations.ts)</li><li>[src/features/events/**tests**/registration-pricing.test.ts](../src/features/events/__tests__/registration-pricing.test.ts)</li><li>[src/features/events/events.db-types.ts](../src/features/events/events.db-types.ts)</li><li>[src/features/events/events.schemas.ts](../src/features/events/events.schemas.ts)</li><li>[src/db/schema/events.schema.ts](../src/db/schema/events.schema.ts)</li><li>[src/db/schema/index.ts](../src/db/schema/index.ts)</li><li>[src/tests/utils.tsx](../src/tests/utils.tsx)</li><li>[src/tests/setup.ts](../src/tests/setup.ts)</li><li>[src/tests/mocks/auth.ts](../src/tests/mocks/auth.ts)</li><li>[src/lib/payments/square.ts](../src/lib/payments/square.ts)</li></ul> |

### EVT-3: Event Mutation Time & Metadata Utilities

|                          |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| ------------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Status**               | ‚úÖ Completed                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| **Priority**             | üü† High (consistency & maintainability)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| **Problem**              | Event mutations repeatedly instantiate `const now = new Date()` and rebuild payment metadata in-line, which risks divergent timestamps and inconsistent audit data across cancellation, reminder, and registration flows.                                                                                                                                                                                                                                                                                                                                                                 |
| **Desired Outcome**      | Centralized helpers that produce consistent timestamps and payment metadata snapshots, reducing duplication and making future audit logging trivial.                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| **Implementation Notes** | <ul><li>Extract reusable utilities (e.g., `buildPaymentSnapshot`, `currentTimestamp`) into a server-only helper module under `src/features/events/` (or `src/features/events/utils/`).</li><li>Refactor `registerForEvent`, `cancelEvent`, `markEtransferPaid`, and `markEtransferReminder` to consume the shared helpers.</li><li>Ensure helpers accept `Date` injections for testability and update existing tests/new tests accordingly.</li><li>Document the helper usage within the module to guide future mutations.</li></ul>                                                      |
| **Linked Files**         | <ul><li>[src/features/events/events.mutations.ts](../src/features/events/events.mutations.ts)</li><li>[src/features/events/events.types.ts](../src/features/events/events.types.ts)</li><li>[src/features/events/events.db-types.ts](../src/features/events/events.db-types.ts)</li><li>[src/features/events/events.schemas.ts](../src/features/events/events.schemas.ts)</li><li>[src/features/events/**tests**/](../src/features/events/__tests__/)</li><li>[src/lib/server/fn-utils.ts](../src/lib/server/fn-utils.ts)</li><li>[src/tests/utils.tsx](../src/tests/utils.tsx)</li></ul> |

---

## üî∑ P2 ‚Äì Medium Priority

### APP-1: Router Event Type Coverage & Diagnostics

|                          |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| ------------------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------- |
| **Status**               | ‚úÖ Completed                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| **Priority**             | üü° Medium (DX & observability)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **Problem**              | We disabled client-side navigation logging because TypeScript lacks declarations for `router.subscribe("onNavigateStart"                                                                                                                                                                                                                                                                                                                                                                                                                       | "onNavigateEnd")`. Without types, engineers lose out on low-friction diagnostics during routing issues. |
| **Desired Outcome**      | Strongly-typed router event subscriptions re-enabled in `src/client.tsx`, with optional logging that can be toggled without TS errors or lint suppressions.                                                                                                                                                                                                                                                                                                                                                                                    |
| **Implementation Notes** | <ul><li>Add a module augmentation for `@tanstack/react-router` that declares the event signatures (e.g., in `src/types/router-events.d.ts`).</li><li>Create a small helper wrapper (e.g., `subscribeToRouterDiagnostics(router)`) that centralizes the subscriptions and optional logging flags.</li><li>Re-enable the commented logging in `src/client.tsx`, but guard it behind an environment flag (`VITE_ROUTER_DEBUG`).</li><li>Document the diagnostics usage in a JSDoc comment or README snippet for future troubleshooting.</li></ul> |
| **Linked Files**         | <ul><li>[src/client.tsx](../src/client.tsx)</li><li>[src/router.tsx](../src/router.tsx)</li><li>[src/routeTree.gen.ts](../src/routeTree.gen.ts)</li><li>[src/app/providers.tsx](../src/app/providers.tsx)</li><li>[tsconfig.json](../tsconfig.json)</li><li>[vite.config.ts](../vite.config.ts)</li></ul>                                                                                                                                                                                                                                      |

### DOC-1: Backlog & Release Notes Alignment

|               |                                                                                                                                                                                                                                                                             |
| ------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Status**    | ‚ùå Not Started                                                                                                                                                                                                                                                              |
| **Priority**  | üü¢ Medium                                                                                                                                                                                                                                                                   |
| **Why**       | Essential for team captains and admins to find players                                                                                                                                                                                                                      |
| **Code refs** | `src/routes/dashboard/members.tsx`, create new `src/features/members/*`                                                                                                                                                                                                     |
| **Tasks**     | <ul><li>Create getAllMembers server query with joins</li><li>Build filterable DataTable UI</li><li>Add search by name/email/team</li><li>Implement privacy settings respect</li><li>Add export to CSV functionality</li><li>Create member detail view (read-only)</li></ul> |

### Team Invitations Flow

|               |                                                                                                                                                                                                                                           |
| ------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Status**    | ‚ùå Not Started                                                                                                                                                                                                                            |
| **Priority**  | üü¢ Medium                                                                                                                                                                                                                                 |
| **Why**       | Backend exists but no UI for pending invitations                                                                                                                                                                                          |
| **Code refs** | `src/features/teams/components/team-invitations.tsx` (create)                                                                                                                                                                             |
| **Tasks**     | <ul><li>Show pending status in team members list</li><li>Create invitations dashboard section</li><li>Add accept/decline buttons</li><li>Send invitation emails via SendGrid</li><li>Add notification badge for pending invites</li></ul> |

---

## üîÆ Future Roadmap

- **Event Registration Payment Flow** - Integrate Square for event fees
- **E-transfer Payment Option** - Alternative payment method
- **Image Uploads** - Profile pictures and team logos via Cloudinary
- **Mobile PWA** - Offline support for event day check-ins
- **Public Content Pages** - About, Resources, Contact pages
- **Advanced Permissions** - Event-specific and team-specific roles
- **Bulk Operations** - Import/export members, batch email sending
- **Analytics Dashboard** - Membership trends, event attendance stats

---

## üìù Cross-Cutting Notes

- **E2E Tests Required**: All new features must include E2E tests in `e2e/tests/`
- **Documentation**: Update relevant docs in `/docs/` with any schema or API changes
- **Type Safety**: Use Zod validation for all server functions (see CLAUDE.md)
- **Components**: Install new shadcn components to `src/components/ui` (per components.json)
- **Rate Limiting**: Use `useRateLimitedServerFn` from Pacer for client-side rate limiting

---

## Frontend Enhancement Tickets

### FE-2: Public Pages Content & Polish

|                |                                                                                                                                                                                                                                                                                     |
| -------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Status**     | ‚ùå Not Started                                                                                                                                                                                                                                                                      |
| **Why now**    | Public site needs real content; currently using placeholder text/images                                                                                                                                                                                                             |
| **Depends on** | None (frontend only)                                                                                                                                                                                                                                                                |
| **Code refs**  | `src/routes/index.tsx`, `src/shared/ui/hero-section.tsx`, `src/shared/ui/event-card.tsx`                                                                                                                                                                                            |
| **Tasks**      | <ul><li>Replace placeholder images with tabletop game-specific imagery</li><li>Update hero section copy to match brand voice</li><li>Create About, Teams, Resources static pages</li><li>Add loading states for event cards</li><li>Implement 404 page with brand styling</li></ul> |
| **Thoughts**   | Work with stakeholders for copy/images; can use Unsplash API for temp ones images                                                                                                                                                                                                   |

---

---

### FE-4: Mobile PWA Optimization

|                |                                                                                                                                                                                                                                                                                 |
| -------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Status**     | ‚ùå Not Started                                                                                                                                                                                                                                                                  |
| **Why now**    | Mobile usage expected to be high for event check-ins; current mobile experience is basic                                                                                                                                                                                        |
| **Depends on** | None, but best after core features (P1+)                                                                                                                                                                                                                                        |
| **Code refs**  | `public/manifest.json` (create), `src/app.tsx`, service worker setup                                                                                                                                                                                                            |
| **Tasks**      | <ul><li>Add PWA manifest with Roundup Games branding</li><li>Implement service worker for offline support</li><li>Add install prompt for mobile users</li><li>Optimize touch targets for mobile</li><li>Add pull-to-refresh on dashboard</li><li>Test on real devices</li></ul> |
| **Thoughts**   | Vite has PWA plugin; focus on offline-first for event days with poor connectivity                                                                                                                                                                                               |

---

### FE-3: Loading & Error States Polish

|                |                                                                                                                                                                                                                                                          |
| -------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Status**     | ‚ùå Not Started                                                                                                                                                                                                                                           |
| **Why now**    | Current error handling is basic; need consistent UX across app                                                                                                                                                                                           |
| **Depends on** | None                                                                                                                                                                                                                                                     |
| **Code refs**  | `src/components/DefaultCatchBoundary.tsx`, existing components                                                                                                                                                                                           |
| **Tasks**      | <ul><li>Create consistent error boundary UI with retry actions</li><li>Add skeleton loaders for all data-fetching components</li><li>Add optimistic updates for better perceived performance</li><li>Implement retry logic for failed requests</li></ul> |
| **Thoughts**   | Already using Sonner for toasts; focus on skeleton loaders and error boundaries                                                                                                                                                                          |

---

## Form Component Library (Remaining Tasks)

|               |                                                                                                                                                                                                                   |
| ------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Status**    | üöß Partially Complete                                                                                                                                                                                             |
| **Completed** | ValidatedDatePicker, ValidatedSelect, ValidatedInput, Sonner toasts, shadcn components                                                                                                                            |
| **Remaining** | <ul><li>Create PhoneInput with formatting</li><li>Create FileUpload component (for future profile pics)</li><li>Add Storybook or demo page for component library</li><li>Unit tests for form components</li></ul> |
| **Code refs** | `src/components/form-fields/*`                                                                                                                                                                                    |
