flowchart TB
  subgraph Submission["User Submission Flow"]
    direction LR
    B[Browser]:::user --> API[API - Lambda]:::app --> VAL[Validation + Rules]:::app --> DB[(RDS PostgreSQL)]:::data --> AUD[Audit Log - append-only hash chain]:::audit
  end

  subgraph Reporting["Reporting Flow"]
    direction LR
    UI[Report Builder]:::user --> QAPI[Query API]:::app --> ACL[Access Control - RBAC + org scope]:::security --> AGG[Aggregation / Compute]:::app --> EXP[Export CSV/PDF]:::data
  end

  subgraph Notifications["Notification Flow"]
    direction LR
    EVT[Domain Event]:::app --> Q[SQS Queue]:::queue --> WRK[Worker Lambda/Job]:::app --> OUT[Email SES and In-App]:::queue
  end

  subgraph Legend
    L1[User / Client]:::user
    L2[App / Service]:::app
    L3[Data Store]:::data
    L4[Async / Events]:::queue
    L5[Security Control]:::security
    L6[Audit Log]:::audit
  end

  classDef edge fill:#E3EEF8,stroke:#2E5F8A,color:#1C3D5A;
  classDef app fill:#E6F4EA,stroke:#2E7D32,color:#1B5E20;
  classDef data fill:#FFF3E0,stroke:#EF6C00,color:#4E342E;
  classDef queue fill:#E0F2F1,stroke:#00796B,color:#004D40;
  classDef security fill:#ECEFF1,stroke:#546E7A,color:#263238;
  classDef user fill:#F5F5F5,stroke:#616161,color:#212121;
  classDef audit fill:#FBE9E7,stroke:#D84315,color:#4E342E;
